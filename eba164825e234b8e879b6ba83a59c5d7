{
    "assignee": null,
    "blocks": [],
    "close_status": null,
    "closed_at": null,
    "comments": [
        {
            "comment": "FWIW I've seen similar issues when I tried using `buildah` and `podman` manually, however `podman build` worked on my own containers.",
            "date_created": "1544482276",
            "edited_on": null,
            "editor": null,
            "id": 545881,
            "notification": false,
            "parent": null,
            "reactions": {},
            "user": {
                "default_email": "edwin+bugs@etorok.eu",
                "emails": [
                    "edwin+bugs@etorok.eu"
                ],
                "fullname": "T\u00f6r\u00f6k Edwin",
                "name": "edwintorok"
            }
        },
        {
            "comment": "I think this is the same problem as https://github.com/containers/buildah/issues/1224.\r\nI probably had the configuration generated by an older version of podman, and when I updated then podman and buildah couldn't both read it.\r\nWiping that file, and letting podman recreate it fixed this problem.",
            "date_created": "1544981159",
            "edited_on": null,
            "editor": null,
            "id": 546690,
            "notification": false,
            "parent": null,
            "reactions": {},
            "user": {
                "default_email": "edwin+bugs@etorok.eu",
                "emails": [
                    "edwin+bugs@etorok.eu"
                ],
                "fullname": "T\u00f6r\u00f6k Edwin",
                "name": "edwintorok"
            }
        }
    ],
    "content": "fedora-toolbox create worked once after I installed silverblue.\r\nI did some rpm-ostree upgrades, installed some more packages, ran some containers, changed my shell, etc.\r\nThen I deleted then toolbox containers and tried to run fedora-toolbox create to create me a fresh one, but it failed:\r\n\r\n```\r\nbash -x /usr/bin/fedora-toolbox -v create\r\n+ unset _mlshdbg\r\n+ '[' 0 = 1 ']'\r\n+ export MODULES_RUN_QUARANTINE=LD_LIBRARY_PATH\r\n+ MODULES_RUN_QUARANTINE=LD_LIBRARY_PATH\r\n+ unset _mlre _mlIFS\r\n+ '[' -n x ']'\r\n+ _mlIFS=' \t\r\n'\r\n+ IFS=' '\r\n+ for _mlv in ${MODULES_RUN_QUARANTINE:-}\r\n+ '[' LD_LIBRARY_PATH = LD_LIBRARY_PATH -a LD_LIBRARY_PATH = LD_LIBRARY_PATH ']'\r\n++ eval 'echo ${LD_LIBRARY_PATH+x}'\r\n+++ echo\r\n+ '[' -n '' ']'\r\n+ _mlrv=MODULES_RUNENV_LD_LIBRARY_PATH\r\n++ eval 'echo ${MODULES_RUNENV_LD_LIBRARY_PATH:-}'\r\n+++ echo\r\n+ _mlre='LD_LIBRARY_PATH='\\'''\\'' '\r\n+ '[' -n 'LD_LIBRARY_PATH='\\'''\\'' ' ']'\r\n+ _mlre='eval LD_LIBRARY_PATH='\\'''\\'' '\r\n++ eval 'LD_LIBRARY_PATH='\\'''\\''' /usr/bin/tclsh /usr/share/Modules/libexec/modulecmd.tcl bash autoinit\r\n+++ LD_LIBRARY_PATH=\r\n+++ /usr/bin/tclsh /usr/share/Modules/libexec/modulecmd.tcl bash autoinit\r\n+ _mlcode='_module_raw() {\r\n   unset _mlshdbg;\r\n   if [ \"${MODULES_SILENT_SHELL_DEBUG:-0}\" = '\\''1'\\'' ]; then\r\n      case \"$-\" in\r\n         *v*x*) set +vx; _mlshdbg='\\''vx'\\'' ;;\r\n         *v*) set +v; _mlshdbg='\\''v'\\'' ;;\r\n         *x*) set +x; _mlshdbg='\\''x'\\'' ;;\r\n         *) _mlshdbg='\\'''\\'' ;;\r\n      esac;\r\n   fi;\r\n   unset _mlre _mlIFS;\r\n   if [ -n \"${IFS+x}\" ]; then\r\n      _mlIFS=$IFS;\r\n   fi;\r\n   IFS='\\'' '\\'';\r\n   for _mlv in ${MODULES_RUN_QUARANTINE:-}; do\r\n      if [ \"${_mlv}\" = \"${_mlv##*[!A-Za-z0-9_]}\" -a \"${_mlv}\" = \"${_mlv#[0-9]}\" ]; then\r\n         if [ -n \"`eval '\\''echo ${'\\''$_mlv'\\''+x}'\\''`\" ]; then\r\n            _mlre=\"${_mlre:-}${_mlv}_modquar='\\''`eval '\\''echo ${'\\''$_mlv'\\''}'\\''`'\\'' \";\r\n         fi;\r\n         _mlrv=\"MODULES_RUNENV_${_mlv}\";\r\n         _mlre=\"${_mlre:-}${_mlv}='\\''`eval '\\''echo ${'\\''$_mlrv'\\'':-}'\\''`'\\'' \";\r\n      fi;\r\n   done;\r\n   if [ -n \"${_mlre:-}\" ]; then\r\n      eval `eval ${_mlre}/usr/bin/tclsh /usr/share/Modules/libexec/modulecmd.tcl bash '\\''\"$@\"'\\''`;\r\n   else\r\n      eval `/usr/bin/tclsh /usr/share/Modules/libexec/modulecmd.tcl bash \"$@\"`;\r\n   fi;\r\n   _mlstatus=$?;\r\n   if [ -n \"${_mlIFS+x}\" ]; then\r\n      IFS=$_mlIFS;\r\n   else\r\n      unset IFS;\r\n   fi;\r\n   unset _mlre _mlv _mlrv _mlIFS;\r\n   if [ -n \"${_mlshdbg:-}\" ]; then\r\n      set -$_mlshdbg;\r\n   fi;\r\n   unset _mlshdbg;\r\n   return $_mlstatus;\r\n};\r\nmodule() { _module_raw \"$@\" 2>&1; };\r\nMODULES_CMD=/usr/share/Modules/libexec/modulecmd.tcl; export MODULES_CMD;\r\nMODULESHOME=/usr/share/Modules; export MODULESHOME;\r\ntest 0;'\r\n+ _mlret=0\r\n+ '[' -n x ']'\r\n+ IFS=' \t\r\n'\r\n+ unset _mlIFS\r\n+ unset _mlre _mlv _mlrv\r\n+ '[' 0 -eq 0 ']'\r\n+ eval '_module_raw() {\r\n   unset _mlshdbg;\r\n   if [ \"${MODULES_SILENT_SHELL_DEBUG:-0}\" = '\\''1'\\'' ]; then\r\n      case \"$-\" in\r\n         *v*x*) set +vx; _mlshdbg='\\''vx'\\'' ;;\r\n         *v*) set +v; _mlshdbg='\\''v'\\'' ;;\r\n         *x*) set +x; _mlshdbg='\\''x'\\'' ;;\r\n         *) _mlshdbg='\\'''\\'' ;;\r\n      esac;\r\n   fi;\r\n   unset _mlre _mlIFS;\r\n   if [ -n \"${IFS+x}\" ]; then\r\n      _mlIFS=$IFS;\r\n   fi;\r\n   IFS='\\'' '\\'';\r\n   for _mlv in ${MODULES_RUN_QUARANTINE:-}; do\r\n      if [ \"${_mlv}\" = \"${_mlv##*[!A-Za-z0-9_]}\" -a \"${_mlv}\" = \"${_mlv#[0-9]}\" ]; then\r\n         if [ -n \"`eval '\\''echo ${'\\''$_mlv'\\''+x}'\\''`\" ]; then\r\n            _mlre=\"${_mlre:-}${_mlv}_modquar='\\''`eval '\\''echo ${'\\''$_mlv'\\''}'\\''`'\\'' \";\r\n         fi;\r\n         _mlrv=\"MODULES_RUNENV_${_mlv}\";\r\n         _mlre=\"${_mlre:-}${_mlv}='\\''`eval '\\''echo ${'\\''$_mlrv'\\'':-}'\\''`'\\'' \";\r\n      fi;\r\n   done;\r\n   if [ -n \"${_mlre:-}\" ]; then\r\n      eval `eval ${_mlre}/usr/bin/tclsh /usr/share/Modules/libexec/modulecmd.tcl bash '\\''\"$@\"'\\''`;\r\n   else\r\n      eval `/usr/bin/tclsh /usr/share/Modules/libexec/modulecmd.tcl bash \"$@\"`;\r\n   fi;\r\n   _mlstatus=$?;\r\n   if [ -n \"${_mlIFS+x}\" ]; then\r\n      IFS=$_mlIFS;\r\n   else\r\n      unset IFS;\r\n   fi;\r\n   unset _mlre _mlv _mlrv _mlIFS;\r\n   if [ -n \"${_mlshdbg:-}\" ]; then\r\n      set -$_mlshdbg;\r\n   fi;\r\n   unset _mlshdbg;\r\n   return $_mlstatus;\r\n};\r\nmodule() { _module_raw \"$@\" 2>&1; };\r\nMODULES_CMD=/usr/share/Modules/libexec/modulecmd.tcl; export MODULES_CMD;\r\nMODULESHOME=/usr/share/Modules; export MODULESHOME;\r\ntest 0;'\r\n++ MODULES_CMD=/usr/share/Modules/libexec/modulecmd.tcl\r\n++ export MODULES_CMD\r\n++ MODULESHOME=/usr/share/Modules\r\n++ export MODULESHOME\r\n++ test 0\r\n+ '[' 0 = 1 ']'\r\n+ '[' -t 2 ']'\r\n+ export -f _module_raw\r\n+ export -f module\r\n+ export -f switchml\r\n+ ENV=/usr/share/Modules/init/profile.sh\r\n+ export ENV\r\n+ BASH_ENV=/usr/share/Modules/init/bash\r\n+ export BASH_ENV\r\n+ '[' 4 -ge 3 ']'\r\n+ [[ hxB =~ i ]]\r\n+ [[ ! :/home/edwin/.local/bin:/usr/share/Modules/bin:/usr/local/bin:/usr/local/sbin:/usr/bin:/usr/sbin:/home/edwin/bin: =~ :/usr/share/Modules/bin: ]]\r\n++ manpath\r\n+ manpath=/usr/local/man:/usr/share/man\r\n+ [[ ! :/usr/local/man:/usr/share/man: =~ :/usr/share/man: ]]\r\n+ unset _mlcode _mlret\r\n+ '[' -n '' ']'\r\n+ source /etc/os-release\r\n++ NAME=Fedora\r\n++ VERSION='29.20181210.0 (Workstation Edition)'\r\n++ ID=fedora\r\n++ VERSION_ID=29\r\n++ PLATFORM_ID=platform:f29\r\n++ PRETTY_NAME='Fedora 29.20181210.0 (Workstation Edition)'\r\n++ ANSI_COLOR='0;34'\r\n++ LOGO=fedora-logo\r\n++ CPE_NAME=cpe:/o:fedoraproject:fedora:29\r\n++ HOME_URL=https://fedoraproject.org/\r\n++ DOCUMENTATION_URL=https://docs.fedoraproject.org/en-US/fedora/f29/system-administrators-guide/\r\n++ SUPPORT_URL=https://fedoraproject.org/wiki/Communicating_and_getting_help\r\n++ BUG_REPORT_URL=https://bugzilla.redhat.com/\r\n++ REDHAT_BUGZILLA_PRODUCT=Fedora\r\n++ REDHAT_BUGZILLA_PRODUCT_VERSION=29\r\n++ REDHAT_SUPPORT_PRODUCT=Fedora\r\n++ REDHAT_SUPPORT_PRODUCT_VERSION=29\r\n++ PRIVACY_POLICY_URL=https://fedoraproject.org/wiki/Legal:PrivacyPolicy\r\n++ VARIANT='Workstation Edition'\r\n++ VARIANT_ID=workstation\r\n++ OSTREE_VERSION=29.20181210.0\r\n+ release=29\r\n+ prefix_sudo=\r\n+ registry=registry.fedoraproject.org\r\n+ registry_candidate=candidate-registry.fedoraproject.org\r\n+ toolbox_prompt='\ud83d\udd39[\\u@\\h \\W]\\$ '\r\n+ exec\r\n+ [[ -v = -* ]]\r\n+ case $1 in\r\n+ exec\r\n+ shift\r\n+ [[ create = -* ]]\r\n+ fgc=f29\r\n+ '[' '' = '' ']'\r\n+ toolbox_container=fedora-toolbox-edwin:29\r\n+ base_toolbox_image=fedora-toolbox:29\r\n+ toolbox_image=fedora-toolbox-edwin:29\r\n+ '[' create = '' ']'\r\n+ op=create\r\n+ shift\r\n+ case $op in\r\n+ [[ '' = -* ]]\r\n+ exit_if_extra_operand\r\n+ '[' '' '!=' '' ']'\r\n+ create\r\n+ dbus_system_bus_address=unix:path=/var/run/dbus/system_bus_socket\r\n+ tmpfs_size=67108864\r\n++ uuidgen --time\r\n+ working_container_name=fedora-toolbox-working-container-1798055a-fccd-11e8-8957-e03f49a06ed4\r\n+ buildah inspect --type image fedora-toolbox-edwin:29\r\nerror reading image \"fedora-toolbox-edwin:29\": error reading image: error locating image \"fedora-toolbox-edwin:29\" for importing settings: error locating image with name \"fedora-toolbox-edwin:29\": image not known\r\nERRO[0000] exit status 1                                \r\n+ buildah from --name fedora-toolbox-working-container-1798055a-fccd-11e8-8957-e03f49a06ed4 localhost/fedora-toolbox:29\r\nError determining manifest MIME type for docker://localhost/fedora-toolbox:29: pinging docker registry returned: Get https://localhost/v2/: dial tcp [::1]:443: connect: connection refused\r\nERRO[0000] exit status 1                                \r\n+ buildah from --name fedora-toolbox-working-container-1798055a-fccd-11e8-8957-e03f49a06ed4 registry.fedoraproject.org/f29/fedora-toolbox:29\r\n+ buildah run fedora-toolbox-working-container-1798055a-fccd-11e8-8957-e03f49a06ed4 -- useradd --no-create-home --shell /bin/zsh --uid 1000 --groups wheel edwin\r\n+ buildah run fedora-toolbox-working-container-1798055a-fccd-11e8-8957-e03f49a06ed4 -- passwd -d edwin\r\npasswd: Note: deleting a password also unlocks the password.\r\n+ buildah run fedora-toolbox-working-container-1798055a-fccd-11e8-8957-e03f49a06ed4 -- passwd -d root\r\npasswd: Note: deleting a password also unlocks the password.\r\n+ buildah config --volume /home/edwin fedora-toolbox-working-container-1798055a-fccd-11e8-8957-e03f49a06ed4\r\n+ buildah config --volume /run/user/1000 fedora-toolbox-working-container-1798055a-fccd-11e8-8957-e03f49a06ed4\r\n+ '[' '' '!=' '' ']'\r\n++ echo unix:path=/var/run/dbus/system_bus_socket\r\n++ cut --delimiter = --fields 2\r\n+ dbus_system_bus_path=/var/run/dbus/system_bus_socket\r\n++ readlink --canonicalize /var/run/dbus/system_bus_socket\r\n+ dbus_system_bus_path=/run/dbus/system_bus_socket\r\n+ buildah config --volume /run/dbus/system_bus_socket fedora-toolbox-working-container-1798055a-fccd-11e8-8957-e03f49a06ed4\r\n+ buildah config --volume /dev/dri fedora-toolbox-working-container-1798055a-fccd-11e8-8957-e03f49a06ed4\r\n+ buildah config --user edwin fedora-toolbox-working-container-1798055a-fccd-11e8-8957-e03f49a06ed4\r\n+ buildah config --workingdir /home/edwin fedora-toolbox-working-container-1798055a-fccd-11e8-8957-e03f49a06ed4\r\n+ buildah commit --rm fedora-toolbox-working-container-1798055a-fccd-11e8-8957-e03f49a06ed4 fedora-toolbox-edwin:29\r\nGetting image source signatures\r\nSkipping fetch of repeat blob sha256:8080f9aa6262000ad12d3d7e55331d275d412faa730b75c41bbf444b4ce056e9\r\nSkipping fetch of repeat blob sha256:d399ea65472cbad41d640ec2a09724c2f11ac7fa52636b6cec6905e8fa490865\r\nCopying blob sha256:564596544eff1eb68e782c24353d929c377718a5577eb3c84af8541ddf51e46a\r\n 1.93 KiB / 1.93 KiB [======================================================] 0s\r\nCopying config sha256:de7b0c518edb5d339160bb63ccd13a7b1dea3af3a969663bdc2b089969aea427\r\n 1.44 KiB / 1.44 KiB [======================================================] 0s\r\nWriting manifest to image destination\r\nStoring signatures\r\n+ podman inspect --type container fedora-toolbox-edwin:29\r\nerror looking up container \"fedora-toolbox-edwin:29\": no container with name or ID fedora-toolbox-edwin:29 found: no such container\r\n++ awk '( $1 == \"MemTotal:\" ) { print $2 }' /proc/meminfo\r\n+ total_ram=32898552\r\n+ is_integer 32898552\r\n+ '[' 32898552 '!=' '' ']'\r\n+ '[' 32898552 -eq 32898552 ']'\r\n+ return 0\r\n+ tmpfs_size=16844058624\r\n+ max_uid_count=65536\r\n+ max_minus_uid=64536\r\n+ uid_plus_one=1001\r\n+ podman create --group-add wheel --hostname toolbox --interactive --name fedora-toolbox-edwin:29 --network host --privileged --security-opt label=disable --tmpfs /dev/shm:size=16844058624 --tty --uidmap 1000:0:1 --uidmap 0:1:1000 --uidmap 1001:1001:64536 --volume /home/edwin:/home/edwin --volume /run/user/1000:/run/user/1000 --volume /run/dbus/system_bus_socket:/run/dbus/system_bus_socket --volume /dev/dri:/dev/dri fedora-toolbox-edwin:29 /bin/sh\r\nTrying to pull docker.io/fedora-toolbox-edwin:29...Failed\r\nTrying to pull registry.fedoraproject.org/fedora-toolbox-edwin:29...Failed\r\nTrying to pull quay.io/fedora-toolbox-edwin:29...Failed\r\nTrying to pull registry.access.redhat.com/fedora-toolbox-edwin:29...Failed\r\nTrying to pull registry.centos.org/fedora-toolbox-edwin:29...Failed\r\nunable to pull fedora-toolbox-edwin:29: 5 errors occurred:\r\n\r\n* Error determining manifest MIME type for docker://fedora-toolbox-edwin:29: Error reading manifest 29 in docker.io/library/fedora-toolbox-edwin: errors:\r\ndenied: requested access to the resource is denied\r\nunauthorized: authentication required\r\n\r\n* Error determining manifest MIME type for docker://registry.fedoraproject.org/fedora-toolbox-edwin:29: Error reading manifest 29 in registry.fedoraproject.org/fedora-toolbox-edwin: manifest unknown: manifest unknown\r\n* Error determining manifest MIME type for docker://quay.io/fedora-toolbox-edwin:29: Error reading manifest 29 in quay.io/fedora-toolbox-edwin: error parsing HTTP 404 response body: invalid character '<' looking for beginning of value: \"<!DOCTYPE HTML PUBLIC \\\"-//W3C//DTD HTML 3.2 Final//EN\\\">\\n<title>404 Not Found</title>\\n<h1>Not Found</h1>\\n<p>The requested URL was not found on the server.  If you entered the URL manually please check your spelling and try again.</p>\\n\"\r\n* Error determining manifest MIME type for docker://registry.access.redhat.com/fedora-toolbox-edwin:29: Error reading manifest 29 in registry.access.redhat.com/fedora-toolbox-edwin: unknown: Not Found\r\n* Error determining manifest MIME type for docker://registry.centos.org/fedora-toolbox-edwin:29: Error reading manifest 29 in registry.centos.org/fedora-toolbox-edwin: manifest unknown: manifest unknown\r\n+ echo '/usr/bin/fedora-toolbox: failed to create container fedora-toolbox-edwin:29'\r\n/usr/bin/fedora-toolbox: failed to create container fedora-toolbox-edwin:29\r\n+ exit 1\r\n+ exit\r\n```\r\n\r\nThis is the state after running the above script:\r\n```\r\n$ buildah images\r\nIMAGE NAME                                               IMAGE TAG            IMAGE ID             CREATED AT             SIZE\r\ndocker.io/library/fedora                                 29                   8c568f104326         Nov 7, 2018 00:23      275 MB\r\nregistry.fedoraproject.org/f29/fedora-toolbox            29                   032b427fbbf7         Sep 27, 2018 11:47     578 MB\r\nlocalhost/fedora-toolbox-edwin                           29                   de7b0c518edb         Dec 10, 2018 22:44     578 MB\r\n\r\n$ podman images\r\nREPOSITORY                                      TAG   IMAGE ID       CREATED        SIZE\r\ndocker.io/library/fedora                        29    8c568f104326   4 weeks ago    275MB\r\ndocker.io/library/fedora                        28    f0b9fdd4254d   4 weeks ago    270MB\r\nregistry.fedoraproject.org/f29/fedora-toolbox   29    032b427fbbf7   2 months ago   578MB\r\n\r\n$ podman ps -a\r\n$ buildah containers -a\r\nCONTAINER ID  BUILDER  IMAGE ID     IMAGE NAME                       CONTAINER NAME\r\n\r\n$ rpm-ostree status\r\nState: idle\r\nWarning: failed to query journal: address not available\r\nAutomaticUpdates: stage; rpm-ostreed-automatic.timer: last run 2h 50min ago\r\nDeployments:\r\n\u25cf ostree://fedora-workstation:fedora/29/x86_64/silverblue\r\n                   Version: 29.20181210.0 (2018-12-10T01:01:33Z)\r\n                BaseCommit: f7108ac43e6b618fe9470b213ce9391e5d2489866e4e1242a0af6bf12f4b7c8b\r\n              GPGSignature: Valid signature by 5A03B4DD8254ECA02FDA1637A20AA56B429476B4\r\n           LayeredPackages: '[fedora-toolbox]' ansible bcc-tools chromium evolution fedora-toolbox kernel-tools latencytop mozilla-ublock-origin neovim perf ripgrep stow system-storage-manager tig vim yum-utils\r\n                            zsh\r\n\r\n  ostree://fedora-workstation:fedora/29/x86_64/silverblue\r\n                   Version: 29.20181209.0 (2018-12-09T01:05:12Z)\r\n                BaseCommit: ab52579b9965a871e3db1987c6e0a256fecaeb03a3d72df1a8b76baaf2406d8d\r\n              GPGSignature: Valid signature by 5A03B4DD8254ECA02FDA1637A20AA56B429476B4\r\n           LayeredPackages: '[fedora-toolbox]' ansible bcc-tools chromium evolution fedora-toolbox kernel-tools latencytop mozilla-ublock-origin neovim perf ripgrep stow system-storage-manager tig vim yum-utils\r\n                            zsh\r\n\r\n```\r\n",
    "custom_fields": [],
    "date_created": "1544482226",
    "depends": [],
    "id": 60,
    "last_updated": "1544981159",
    "milestone": null,
    "priority": null,
    "private": false,
    "status": "Open",
    "tags": [],
    "title": "fedora-toolbox create doesn't work anymore: podman cannot see image created by buildah?",
    "user": {
        "default_email": "edwin+bugs@etorok.eu",
        "emails": [
            "edwin+bugs@etorok.eu"
        ],
        "fullname": "T\u00f6r\u00f6k Edwin",
        "name": "edwintorok"
    }
}